<main class="app-container relatorio-page">
  <section class="card" aria-labelledby="reports-title">
    <!-- PAINEL PRINCIPAL (filtros + botões à esquerda) -->
    <div class="panel--accent rel-main" style="padding-top:26px;">
      <div style="display:flex; gap:12px; align-items:center;">
        <div class="brand"><img src="assets/img/monkey.png" alt="logo" /></div>
        <h1 class="h1" id="reports-title">Relatórios</h1>
      </div>

      <div style="margin-top:18px; width:100%;">
        <!-- filtros -->
        <div class="filters" style="display:flex; gap:12px; align-items:end; margin-bottom:12px; flex-wrap:wrap;">
          <div class="filter">
            <label class="muted">Tipo</label>
            <select class="input" [(ngModel)]="filtros.tipo">
              <option value="ambos">Ambos</option>
              <option value="despesa">Despesas</option>
              <option value="receita">Receitas</option>
            </select>
          </div>

          <div class="filter">
            <label class="muted">Período inicial</label>
            <input class="input" type="date" [(ngModel)]="filtros.dataInicial" />
          </div>

          <div class="filter">
            <label class="muted">Período final</label>
            <input class="input" type="date" [(ngModel)]="filtros.dataFinal" />
          </div>

          <div class="filter">
            <label class="muted">Categoria</label>
            <select class="input" [(ngModel)]="filtros.categoriaId">
              <option [ngValue]="null">Todas</option>
              <option *ngFor="let c of categorias" [ngValue]="c.id">{{ c.nome }}</option>
            </select>
          </div>

          <div class="filter">
            <label class="muted">Forma Pagto</label>
            <select class="input" [(ngModel)]="filtros.formaPagamentoId">
              <option [ngValue]="null">Todas</option>
              <option *ngFor="let f of formasPagamento" [ngValue]="f.id">{{ f.nome }}</option>
            </select>
          </div>
        </div>

        <!-- BOTÕES A ESQUERDA (aqui onde você pediu) -->
        <div class="actions-left" style="display:flex; gap:12px; align-items:center; margin-bottom:16px;">
          <button class="btn-cream" type="button" (click)="atualizar()">Atualizar</button>
  <button class="btn-cream" type="button" (click)="gerarRelatorio()">Gerar Relatório</button>
  <button class="btn-cream" type="button" (click)="exportar()">Exportar (Excel)</button>
  <button class="btn-cream" type="button" (click)="voltar()">Voltar</button>
        </div>

        <!-- espaço principal para conteúdo dinâmico (tabela/gráficos) -->
        <div class="rel-content">
          <p class="sub">Aqui podem ir gráficos, tabela de lançamentos, filtros avançados ou preview do relatório.</p>
        </div>
      </div>
    </div>

    <!-- PAINEL LATERAL (RESUMOS PUXADOS DA API) -->
    <aside class="panel--light rel-side" style="align-items:flex-start; padding:24px 20px;">
      <div style="width:100%;">
        <h2 class="h2" style="margin-bottom:12px; text-align:left; color:#2b2b2b;">Resumos</h2>

        <div class="report-list" aria-live="polite">
          <!-- Resumo geral -->
          <div class="menu-card" *ngIf="resumoLoaded">
            <div class="menu-head"><h3>Resumo</h3></div>
            <p class="sub">Total receitas: {{ resumo?.totalReceitas | number:'1.2-2' }}</p>
            <p class="sub">Total despesas: {{ resumo?.totalDespesas | number:'1.2-2' }}</p>
            <p class="sub">Saldo: {{ resumo?.saldo | number:'1.2-2' }}</p>
          </div>

          <!-- Por Categoria -->
          <div class="menu-card" *ngIf="porCategoriaLoaded && porCategoria?.length">
            <div class="menu-head"><h3>Por Categoria</h3></div>
            <div *ngFor="let p of porCategoria">
              <div style="display:flex; justify-content:space-between;">
                <small>{{ p.categoria }}</small>
                <strong>{{ p.total | number:'1.2-2' }}</strong>
              </div>
            </div>
          </div>

          <!-- Fluxo -->
          <div class="menu-card" *ngIf="fluxoLoaded && fluxo?.length">
            <div class="menu-head"><h3>Fluxo</h3></div>
            <div *ngFor="let f of fluxo | slice:0:6">
              <small>{{ f.data | date:'shortDate' }} — Saldo: {{ f.saldoAcumulado | number:'1.2-2' }}</small>
            </div>
          </div>

          <!-- Mensal -->
          <div class="menu-card mensal" *ngIf="mensalLoaded && mensal?.length">
            <div class="menu-head"><h3>Mensal</h3></div>
          
            <div class="grid-months">
              <div class="line" *ngFor="let m of mensal">
                <small>{{ formatMes(m.mes) }}/{{ anoSelecionado }}</small>
                <strong class="val">{{ m.saldo | number:'1.2-2' }}</strong>
              </div>
            </div>
          </div>
          

          <!-- Se nenhum dado carregado -->
          <div class="menu-card" *ngIf="!resumoLoaded && !porCategoriaLoaded && !fluxoLoaded && !mensalLoaded">
            <p class="sub">Nenhum resumo carregado. Clique em "Gerar Relatório".</p>
          </div>
        </div>

      </div>
    </aside>
  </section>
</main>
